#pragma once
#include <string>
#include <iostream>

class Account {
private:
    std::string id;
    std::string ownerName;
    std::string passwordHash;
    double balance;
public:
    Account() = default;
    Account(const std::string& id, const std::string& name, const std::string& passHash, double bal);

    std::string getId() const;
    std::string getOwner() const;
    double getBalance() const;
    bool checkPassword(const std::string& passHash) const;

    void deposit(double amount);
    bool withdraw(double amount);
    bool transfer(Account& to, double amount);

    void display() const;
};

#include "AccountManager.h"
#include <fstream>
#include <iomanip>
#include <sstream>

void AccountManager::loadFromFile() {
    std::ifstream file("data/accounts.dat", std::ios::binary);
    if (!file) return;
    Account acc;
    while (file.read(reinterpret_cast<char*>(&acc), sizeof(acc))) {
        accounts.push_back(acc);
    }
}

void AccountManager::saveToFile() {
    std::ofstream file("data/accounts.dat", std::ios::binary | std::ios::trunc);
    for (auto& acc : accounts) {
        file.write(reinterpret_cast<const char*>(&acc), sizeof(acc));
    }
}

Account* AccountManager::findById(const std::string& id) {
    for (auto& acc : accounts)
        if (acc.getId() == id)
            return &acc;
    return nullptr;
}

void AccountManager::createAccount(const std::string& name, const std::string& pass, double balance) {
    std::ostringstream oss;
    oss << "AC" << std::setw(5) << std::setfill('0') << accounts.size() + 1;
    std::string id = oss.str();
    std::string passHash = Encryption::hash(pass);
    accounts.emplace_back(id, name, passHash, balance);
    saveToFile();
}

#include "Logger.h"
#include <fstream>
#include <ctime>

void Logger::log(const std::string& msg) {
    std::ofstream file("data/transactions.log", std::ios::app);
    time_t now = time(nullptr);
    file << "[" << ctime(&now) << "] " << msg << "\n";
}
